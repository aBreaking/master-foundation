容器化环境session失效的问题

# 问题描述

容器化环境的前台WEB登录页面，偶尔会出现session失效的问题。

具体表现在：登录西区营业web，一些操作，过几分钟（两三分钟均可能），切换账号再次登录营业web，偶尔就会出现session失效的提示。

所以问题麻烦点就在于这个偶尔，因为并不是有规律或经常性的出现该问题。



# 处理过程

问题跟踪记录贴：[http://eip.teamshub.com/t/5603926](http://eip.teamshub.com/t/5603926)

时间轴：

11月15日

与总体组人员（yangjj、chenmin、zhufk、liwei_paas）进行讨论，一个初步验证步骤，根据chenmin的提议，如果session超时，那么日志文件中肯定会有timeout的异常，但是在容器化平台的日志文件中 grep “time out”的字眼，并没有期望的日志内容；



11月16日

又进行一遍讨论，尝试将session失效的问题给复现出来。个人使用测试组的账号进行营业web登录，但是问题未复现。测试组进行反复测试，url抓包，成功复现该问题，并获取到请求的cookie内容，发现少了`tsid`参数。

![image-20211117150523768](C:\Users\MI\AppData\Roaming\Typora\typora-user-images\image-20211117150523768.png)

（上图是正常的Url请求中的cookie内容，下图是出现session失效的cookie内容）

与lixma沟通，确认tsid等生成策略，理解到目前容器环境的session-core.jar包是有设置失效时间的，时间为1年。

与chenmin确认，目前生产系统上的session-core.jar包是没有设置失效的，所以生产系统没有出现过session失效的问题。

此外，了解到，浏览器（IE）对于有设置失效时间的cookie，会在本地缓存一个临时文件，后续cookie的内容（比如tsid）都会从该临时文件里获取；



11月17日

结合前几次的讨论分析，对照当前出问题的容器化环境 和正常的生产环境，发现这两个环境有两处不同：

1. 环境不同，一个是在容器里运行的，另一个是在物理主机上运行的；
2. session-core.jar包不同，一个是设置了失效时间，另一个未设置失效时间。

所以，个人建议直接将生产环境的sesson-core.jar包替换测试环境jar包，再次测试，看是否会出现session失效的情况。过程如下：

1. 与平台组将生产环境的jar包替换容器化环境；
2. 与测试组进行替换后的容器环境功能测试，是否再出现session失效的问题；
3. 与产品线同事联系，session-core.jar里设置失效的原理，以及当初为什么取消该失效时间的原因；



# 问题定位



# 问题解决

